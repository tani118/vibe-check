<!DOCTYPE html>
<html>
<head>
    <title>Database Debug Test</title>
</head>
<body>
    <h1>Database Debug Test</h1>
    <div id="output"></div>
    
    <script type="module">
        // Test localStorage directly
        console.log('Testing localStorage...')
        localStorage.setItem('test', 'working')
        console.log('localStorage test:', localStorage.getItem('test'))
        
        // Test our database functions
        const createUser = (username, password, avatar) => {
            const users = JSON.parse(localStorage.getItem('vibeChecker_users') || '[]')
            
            // Check if user already exists
            if (users.find(u => u.username === username)) {
                return { success: false, error: 'User already exists' }
            }
            
            const newUser = {
                id: Date.now().toString(),
                username,
                password, // In real app, this would be hashed
                avatar,
                createdAt: new Date().toISOString(),
                currentVibe: null,
                totalQuizzes: 0
            }
            
            users.push(newUser)
            localStorage.setItem('vibeChecker_users', JSON.stringify(users))
            
            console.log('User created:', newUser)
            return { success: true, user: { ...newUser, password: undefined } }
        }
        
        const loginUser = (username, password) => {
            const users = JSON.parse(localStorage.getItem('vibeChecker_users') || '[]')
            const user = users.find(u => u.username === username && u.password === password)
            
            if (!user) {
                return { success: false, error: 'Invalid credentials' }
            }
            
            console.log('User logged in:', user)
            return { success: true, user: { ...user, password: undefined } }
        }
        
        const initializeSampleData = () => {
            const existingUsers = JSON.parse(localStorage.getItem('vibeChecker_users') || '[]')
            
            if (existingUsers.length === 0) {
                const sampleUsers = [
                    {
                        id: 'demo_1',
                        username: 'demo_user_1',
                        password: 'password123',
                        avatar: 'ðŸ˜Ž',
                        createdAt: new Date().toISOString(),
                        currentVibe: 'chill',
                        totalQuizzes: 5
                    },
                    {
                        id: 'demo_2', 
                        username: 'demo_user_2',
                        password: 'password123',
                        avatar: 'ðŸŒŸ',
                        createdAt: new Date().toISOString(),
                        currentVibe: 'energetic',
                        totalQuizzes: 3
                    }
                ]
                
                localStorage.setItem('vibeChecker_users', JSON.stringify(sampleUsers))
                console.log('Sample data initialized:', sampleUsers)
            } else {
                console.log('Sample data already exists:', existingUsers)
            }
        }
        
        // Run tests
        console.log('Initializing sample data...')
        initializeSampleData()
        
        console.log('Testing user creation...')
        const createResult = createUser('test_user', 'test123', 'ðŸ§ª')
        console.log('Create result:', createResult)
        
        console.log('Testing login...')
        const loginResult = loginUser('demo_user_1', 'password123')
        console.log('Login result:', loginResult)
        
        // Show results on page
        document.getElementById('output').innerHTML = `
            <p>Sample Data Initialized</p>
            <p>Create User: ${createResult.success ? 'SUCCESS' : 'FAILED'}</p>
            <p>Login Test: ${loginResult.success ? 'SUCCESS' : 'FAILED'}</p>
            <p>Check console for details</p>
        `
    </script>
</body>
</html>
